<!DOCTYPE html>
<html lang="en">
<head>
    <title>Mon Panier</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="{{ asset('images/icons/favicon.png') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ asset('vendor/bootstrap/css/bootstrap.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('fonts/font-awesome-4.7.0/css/font-awesome.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('fonts/iconic/css/material-design-iconic-font.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('fonts/linearicons-v1.0.0/icon-font.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('vendor/animate/animate.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('vendor/css-hamburgers/hamburgers.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('vendor/animsition/css/animsition.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('vendor/select2/select2.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('vendor/perfect-scrollbar/perfect-scrollbar.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('css/util.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('css/main.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('css/custom-theme.css') }}">
    <style>
        body { padding-top: 80px; }
    </style>
</head>
<body class="animsition">

    {% include 'includes/header.html.twig' %}

    <!-- Sidebar Panier -->
    {% include 'includes/cart_sidebar.html.twig' %}

    <!-- breadcrumb -->
    <div class="container">
        <div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
            <a href="{{ path('app_home') }}" class="stext-109 cl8 hov-cl1 trans-04">
                Accueil
                <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
            </a>
            <span class="stext-109 cl4">Panier</span>
        </div>
    </div>

    <!-- Panier -->
    <section class="bg0 p-t-75 p-b-85">
        <div class="container">
            <h2 class="ltext-109 cl2 p-b-30 txt-center">
                <i class="zmdi zmdi-shopping-cart m-r-10"></i>Mon Panier
                <small class="stext-102 cl6">({{ cart.cartItems|length }} article(s))</small>
            </h2>
            <div class="row">
                <div class="col-lg-8 col-xl-8 m-b-50">
                    {% if cart.cartItems|length > 0 %}
                        <!-- Liste des articles -->
                        {% for item in cart.cartItems %}
                        <div class="cart-item-card" style="display: flex; align-items: center; gap: 20px; padding: 20px; margin-bottom: 15px; background: white; border: 1px solid #DADDEB; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            
                            <!-- Coordonnées du produit (gauche) -->
                            <div style="flex: 2;">
                                <h6 class="mtext-105 cl2 p-b-5">{{ item.product.text }}</h6>
                                <p class="stext-102 cl6">
                                    Dimensions: {{ item.product.largeur }}cm × {{ item.product.hauteur }}cm<br>
                                    Police: {{ item.product.typeEcriture }}
                                </p>
                                {% if item.product.modeleName %}
                                <p class="stext-102 cl5 p-t-5">
                                    <strong>Type: {{ item.product.modeleName }}</strong>
                                </p>
                                {% endif %}
                                
                                <!-- Quantité -->
                                <div style="margin-top: 15px; display: flex; align-items: center; gap: 10px;">
                                    <span class="stext-102 cl6">Quantité:</span>
                                    <div class="wrap-num-product flex-w" style="display: inline-flex;">
                                        <div class="btn-num-product-down cl8 hov-btn3 trans-04 flex-c-m" onclick="updateQuantity({{ item.id }}, {{ item.quantity - 1 }})">
                                            <i class="fs-16 zmdi zmdi-minus"></i>
                                        </div>
                                        <input class="mtext-104 cl3 txt-center num-product" type="number" value="{{ item.quantity }}" min="1" onchange="updateQuantity({{ item.id }}, this.value)" style="width: 50px;">
                                        <div class="btn-num-product-up cl8 hov-btn3 trans-04 flex-c-m" onclick="updateQuantity({{ item.id }}, {{ item.quantity + 1 }})">
                                            <i class="fs-16 zmdi zmdi-plus"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Image du produit (droite) -->
                            <div style="flex: 1; text-align: center;">
                                <img src="{{ asset(item.product.imageUrl ?: 'images/product-detail-01.jpg') }}" alt="{{ item.product.modeleName ?: 'Produit' }}" style="width: 120px; height: 120px; object-fit: cover; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            </div>
                            
                            <!-- Prix et actions (fin) -->
                            <div style="flex: 1; text-align: right; display: flex; flex-direction: column; align-items: flex-end; gap: 10px;">
                                <div>
                                    <p class="stext-102 cl6" style="margin-bottom: 5px;">Prix unitaire</p>
                                    <p class="mtext-106" style="color: #2F4E9B; font-weight: 600;">{{ item.price|number_format(2) }}€</p>
                                </div>
                                <div>
                                    <p class="stext-102 cl6" style="margin-bottom: 5px;">Total</p>
                                    <p class="mtext-110" style="color: #2F4E9B; font-weight: 700; font-size: 20px;">{{ item.subtotal|number_format(2) }}€</p>
                                </div>
                                <button class="how-itemcart1-delete hov-cl1 trans-04" onclick="removeFromCart({{ item.id }})" style="margin-top: 10px; background: #DADDEB; padding: 8px 12px; border-radius: 8px; border: none; cursor: pointer;">
                                    <i class="zmdi zmdi-delete" style="color: #0F1A3A;"></i> Supprimer
                                </button>
                            </div>
                        </div>
                        {% endfor %}

                        <div class="flex-w flex-sb-m p-t-25 p-b-25 p-lr-15">
                            <div class="flex-w flex-m m-r-20 m-tb-5">
                                <button class="flex-c-m stext-101 cl2 size-119 bg8 bor13 hov-btn3 p-lr-15 trans-04 pointer m-tb-10" onclick="clearCart()">
                                    <i class="zmdi zmdi-delete m-r-5"></i> Vider le panier
                                </button>
                            </div>

                            <div class="flex-w flex-m m-tb-5">
                                <a href="{{ path('app_home') }}" class="flex-c-m stext-101 cl2 size-119 bg8 bor13 hov-btn3 p-lr-15 trans-04 pointer m-tb-10">
                                    <i class="zmdi zmdi-arrow-left m-r-5"></i> Continuer les achats
                                </a>
                            </div>
                        </div>
                    {% else %}
                        <div class="txt-center p-t-50 p-b-50">
                            <i class="zmdi zmdi-shopping-cart" style="font-size: 80px; color: #ccc;"></i>
                            <h4 class="mtext-109 cl6 p-t-20 p-b-20">Votre panier est vide</h4>
                            <a href="{{ path('app_home') }}" class="flex-c-m stext-101 cl0 size-116 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer m-t-20">
                                <i class="zmdi zmdi-shopping-basket m-r-5"></i> Continuer les achats
                            </a>
                        </div>
                    {% endif %}
                </div>

                <!-- Résumé du panier -->
                {% if cart.cartItems|length > 0 %}
                <div class="col-lg-4 col-xl-4 m-b-50">
                    <div class="bor10 p-lr-40 p-t-30 p-b-40 p-lr-15-sm" style="position: sticky; top: 100px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-radius: 12px;">
                        <h4 class="mtext-109 cl2 p-b-30">
                            <i class="zmdi zmdi-card m-r-10"></i>Résumé de la commande
                        </h4>

                        <div class="flex-w flex-t bor12 p-b-13">
                            <div class="size-208">
                                <span class="stext-110 cl2">Sous-total:</span>
                            </div>
                            <div class="size-209">
                                <span class="mtext-110 cl2">{{ cart.total|number_format(2) }}€</span>
                            </div>
                        </div>

                        <div class="flex-w flex-t bor12 p-t-15 p-b-30">
                            <div class="size-208 w-full-ssm">
                                <span class="stext-110 cl2">Livraison:</span>
                            </div>
                            <div class="size-209 p-t-1">
                                <span class="stext-111 cl6">Gratuite</span>
                            </div>
                        </div>

                        <div class="flex-w flex-t p-t-27 p-b-33">
                            <div class="size-208">
                                <span class="mtext-101 cl2">Total:</span>
                            </div>
                            <div class="size-209 p-t-1">
                                <span class="mtext-110 cl2" id="cart-total">{{ cart.total|number_format(2) }}€</span>
                            </div>
                        </div>

                        <a href="{{ path('customer_identify') }}" class="stext-101 cl0 bg3 bor14 hov-btn3 p-lr-15 trans-04 pointer" style="text-decoration: none; display: flex; width: 100%; justify-content: center; align-items: center; padding: 15px; border-radius: 8px;">
                            <i class="zmdi zmdi-card" style="margin-right: 8px;"></i> Payer maintenant
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        {% include 'includes/footer.html.twig' %}
    </footer>

    <!-- Back to top -->
    <div class="btn-back-to-top" id="myBtn">
        <span class="symbol-btn-back-to-top">
            <i class="zmdi zmdi-chevron-up"></i>
        </span>
    </div>

<script>
function updateQuantity(itemId, quantity) {
    if (quantity < 1) {
        removeFromCart(itemId);
        return;
    }
    
    fetch(`/cart/update/${itemId}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `quantity=${quantity}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    });
}

function removeFromCart(itemId) {
    if (confirm('Êtes-vous sûr de vouloir supprimer cet article ?')) {
        fetch(`/cart/remove/${itemId}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            }
        });
    }
}

function clearCart() {
    if (confirm('Êtes-vous sûr de vouloir vider le panier ?')) {
        fetch('/cart/clear', {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            }
        });
    }
}
</script>

    <script src="{{ asset('vendor/jquery/jquery-3.2.1.min.js') }}"></script>
    <script src="{{ asset('vendor/animsition/js/animsition.min.js') }}"></script>
    <script src="{{ asset('vendor/bootstrap/js/popper.js') }}"></script>
    <script src="{{ asset('vendor/bootstrap/js/bootstrap.min.js') }}"></script>
    <script src="{{ asset('vendor/select2/select2.min.js') }}"></script>
    <script src="{{ asset('vendor/perfect-scrollbar/perfect-scrollbar.min.js') }}"></script>
    <script src="{{ asset('js/main.js') }}"></script>

</body>
</html>
